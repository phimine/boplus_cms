{"remainingRequest":"/Users/c5281434/Documents/Project/yshopmall_qd-master/node_modules/_vue-loader@15.9.2@vue-loader/lib/index.js??vue-loader-options!/Users/c5281434/Documents/Project/yshopmall_qd-master/src/components/material/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/c5281434/Documents/Project/yshopmall_qd-master/src/components/material/index.vue","mtime":1590767910000},{"path":"/Users/c5281434/Documents/Project/yshopmall_qd-master/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/c5281434/Documents/Project/yshopmall_qd-master/node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/c5281434/Documents/Project/yshopmall_qd-master/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/c5281434/Documents/Project/yshopmall_qd-master/node_modules/_vue-loader@15.9.2@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { getPage as materialgroupPage, addObj as materialgroupAdd, delObj as materialgroupDel, putObj as materialgroupEdit } from '@/api/tools/materialgroup'\nimport { getPage, addObj, delObj, putObj } from '@/api/tools/material'\nimport { getToken } from '@/utils/auth'\nimport { mapGetters } from 'vuex'\n\nexport default {\n  name: 'MaterialList',\n  props: {\n    // 素材数据\n    value: {\n      type: Array,\n      default() {\n        return []\n      }\n    },\n    // 素材类型\n    type: {\n      type: String\n    },\n    // 素材限制数量，默认5个\n    num: {\n      type: Number,\n      default() {\n        return 5\n      }\n    },\n    // 宽度\n    width: {\n      type: Number,\n      default() {\n        return 150\n      }\n    },\n    // 宽度\n    height: {\n      type: Number,\n      default() {\n        return 150\n      }\n    }\n  },\n  data() {\n    return {\n      headers: {\n        Authorization: getToken()\n      },\n      dialogVisible: false,\n      url: '',\n      listDialogVisible: false,\n      materialgroupList: [],\n      materialgroupObjId: '',\n      materialgroupObj: {},\n      materialgroupLoading: false,\n      tableData: [],\n      resultNumber: 0,\n      page: {\n        total: 0, // 总页数\n        currentPage: 1, // 当前页数\n        pageSize: 12, // 每页显示多少条\n        ascs: [], // 升序字段\n        descs: 'create_time'// 降序字段\n      },\n      tableLoading: false,\n      groupId: null,\n      urls: []\n    }\n  },\n  computed: {\n    ...mapGetters([\n      'uploadApi'\n    ])\n  },\n  methods: {\n    moveMaterial(index, type) {\n      if (type == 'up') {\n        const tempOption = this.value[index - 1]\n        this.$set(this.value, index - 1, this.value[index])\n        this.$set(this.value, index, tempOption)\n      }\n      if (type == 'down') {\n        const tempOption = this.value[index + 1]\n        this.$set(this.value, index + 1, this.value[index])\n        this.$set(this.value, index, tempOption)\n      }\n    },\n    zoomMaterial(index) {\n      this.dialogVisible = true\n      this.url = this.value[index]\n    },\n    deleteMaterial(index) {\n      const that = this\n      this.$confirm('是否确认删除？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function() {\n        that.value.splice(index, 1)\n        that.urls = []\n      })\n    },\n    toSeleteMaterial() {\n      this.listDialogVisible = true\n      if (this.tableData.length <= 0) {\n        this.materialgroupPage()\n      }\n    },\n    materialgroupPage() {\n      this.materialgroupLoading = true\n      materialgroupPage({\n        total: 0, // 总页数\n        currentPage: 1, // 当前页数\n        pageSize: 100, // 每页显示多少条\n        ascs: [], // 升序字段\n        descs: 'create_time'// 降序字段\n      }).then(response => {\n        this.materialgroupLoading = false\n        const materialgroupList = response.content\n        materialgroupList.unshift({\n          id: '-1',\n          name: '全部分组'\n        })\n        this.materialgroupList = materialgroupList\n        this.tabClick({\n          index: 0\n        })\n      })\n    },\n    materialgroupDelete(materialgroupObj) {\n      const that = this\n      this.$confirm('是否确认删除该分组？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function() {\n        materialgroupDel(materialgroupObj.id)\n          .then(function() {\n            that.$delete(that.materialgroupList, materialgroupObj.index)\n          })\n      })\n    },\n    materialgroupEdit(materialgroupObj) {\n      const that = this\n      this.$prompt('请输入分组名', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        inputValue: materialgroupObj.name\n      }).then(({ value }) => {\n        materialgroupEdit({\n          id: materialgroupObj.id,\n          name: value\n        }).then(function() {\n          materialgroupObj.name = value\n          that.$set(that.materialgroupList, materialgroupObj.index, materialgroupObj)\n        })\n      }).catch(() => {\n\n      })\n    },\n    materialgroupAdd() {\n      const that = this\n      this.$prompt('请输入分组名', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消'\n      }).then(({ value }) => {\n        materialgroupAdd({\n          name: value\n        }).then(function() {\n          that.materialgroupPage()\n        })\n      }).catch(() => {\n\n      })\n    },\n    tabClick(tab, event) {\n      this.urls = []\n      const index = Number(tab.index)\n      const materialgroupObj = this.materialgroupList[index]\n      materialgroupObj.index = index\n      this.materialgroupObj = materialgroupObj\n      this.materialgroupObjId = materialgroupObj.id\n      this.page.currentPage = 1\n      this.page.total = 0\n      if (materialgroupObj.id != '-1') {\n        this.groupId = materialgroupObj.id\n      } else {\n        this.groupId = null\n      }\n      this.getPage(this.page)\n    },\n    getPage(page, params) {\n      this.tableLoading = true\n      getPage(Object.assign({\n        page: page.currentPage - 1,\n        size: page.pageSize,\n        descs: this.page.descs,\n        ascs: this.page.ascs,\n        sort: 'create_time,desc'\n      }, {\n        groupId: this.groupId\n      })).then(response => {\n        const tableData = response.content\n        this.page.total = response.totalElements\n        this.page.currentPage = page.currentPage\n        this.page.pageSize = page.pageSize\n        this.tableData = tableData\n        this.tableLoading = false\n      }).catch(() => {\n        this.tableLoading = false\n      })\n    },\n    sizeChange(val) {\n      console.log(val)\n      this.page.currentPage = 1\n      this.page.pageSize = val\n      this.getPage(this.page)\n    },\n    pageChange(val) {\n      console.log(val)\n      this.page.currentPage = val\n      // this.page.pageSize = val\n      this.getPage(this.page)\n    },\n    materialRename(item) {\n      const that = this\n      this.$prompt('请输入素材名', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        inputValue: item.name\n      }).then(({ value }) => {\n        putObj({\n          id: item.id,\n          name: value\n        }).then(function() {\n          that.getPage(that.page)\n        })\n      }).catch(() => {\n\n      })\n    },\n    materialUrl(item) {\n      const that = this\n      this.$prompt('素材链接', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        inputValue: item.url\n      }).then(({ value }) => {\n\n      }).catch(() => {\n\n      })\n    },\n    materialDel(item) {\n      const that = this\n      this.$confirm('是否确认删除该素材？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function() {\n        delObj(item.id)\n          .then(function() {\n            that.getPage(that.page)\n          })\n      })\n    },\n    handleCommand(command) {\n      const that = this\n      const s = command.split('-')\n      putObj({\n        id: s[0],\n        groupId: s[1]\n      }).then(function() {\n        that.getPage(that.page)\n      })\n    },\n    handleProgress(event, file, fileList) {\n      console.log(event)\n      // let uploadProgress = file.percentage.toFixed(0)\n      // this.uploadProgress = uploadProgress\n    },\n    handleSuccess(response, file, fileList) {\n      const that = this\n      this.uploadProgress = 0\n      addObj({\n        type: '1',\n        groupId: this.groupId != '-1' ? this.groupId : null,\n        name: file.name,\n        url: response.link\n      }).then(() => {\n        this.resultNumber++\n        if (fileList.length === this.resultNumber) {\n          that.getPage(that.page)\n          this.resultNumber = 0\n        }\n      })\n    },\n    beforeUpload(file) {\n      const isPic =\n        file.type === 'image/jpeg' ||\n        file.type === 'image/png' ||\n        file.type === 'image/gif' ||\n        file.type === 'image/jpg'\n      const isLt2M = file.size / 1024 / 1024 < 2\n      if (!isPic) {\n        this.$message.error('上传图片只能是 JPG、JPEG、PNG、GIF 格式!')\n        return false\n      }\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 2MB!')\n      }\n      return isPic && isLt2M\n    },\n    sureUrls() {\n      this.urls.forEach(item => {\n        this.$set(this.value, this.value.length, item)\n      })\n      this.listDialogVisible = false\n    }\n  }\n}\n",null]}