{"remainingRequest":"/Users/c5281434/Documents/Project/yshopmall_qd-master/node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js!/Users/c5281434/Documents/Project/yshopmall_qd-master/src/router/index.js","dependencies":[{"path":"/Users/c5281434/Documents/Project/yshopmall_qd-master/src/router/index.js","mtime":1590767910000},{"path":"/Users/c5281434/Documents/Project/yshopmall_qd-master/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/c5281434/Documents/Project/yshopmall_qd-master/node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/c5281434/Documents/Project/yshopmall_qd-master/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.loadMenus = void 0;\n\nrequire(\"core-js/modules/es7.object.get-own-property-descriptors\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es6.object.keys\");\n\nvar _defineProperty2 = _interopRequireDefault(require(\"/Users/c5281434/Documents/Project/yshopmall_qd-master/node_modules/@babel/runtime/helpers/defineProperty\"));\n\nvar _routers = _interopRequireDefault(require(\"./routers\"));\n\nvar _store = _interopRequireDefault(require(\"@/store\"));\n\nvar _settings = _interopRequireDefault(require(\"@/settings\"));\n\nvar _nprogress = _interopRequireDefault(require(\"nprogress\"));\n\nrequire(\"nprogress/nprogress.css\");\n\nvar _auth = require(\"@/utils/auth\");\n\nvar _menu = require(\"@/api/system/menu\");\n\nvar _permission = require(\"@/store/modules/permission\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n_nprogress.default.configure({\n  showSpinner: false\n}); // NProgress Configuration\n\n\nvar whiteList = ['/login']; // no redirect whitelist\n\n_routers.default.beforeEach(function (to, from, next) {\n  if (to.meta.title) {\n    document.title = to.meta.title + ' - ' + _settings.default.title;\n  }\n\n  _nprogress.default.start();\n\n  if ((0, _auth.getToken)()) {\n    // 已登录且要跳转的页面是登录页\n    if (to.path === '/login') {\n      next({\n        path: '/'\n      });\n\n      _nprogress.default.done();\n    } else {\n      if (_store.default.getters.roles.length === 0) {\n        // 判断当前用户是否已拉取完user_info信息\n        _store.default.dispatch('GetInfo').then(function (res) {\n          // 拉取user_info\n          // 动态路由，拉取菜单\n          loadMenus(next, to);\n        }).catch(function (err) {\n          console.log(err);\n\n          _store.default.dispatch('LogOut').then(function () {\n            location.reload(); // 为了重新实例化vue-router对象 避免bug\n          });\n        }); // 登录时未拉取 菜单，在此处拉取\n\n      } else if (_store.default.getters.loadMenus) {\n        // 修改成false，防止死循环\n        _store.default.dispatch('updateLoadMenus').then(function (res) {});\n\n        loadMenus(next, to);\n      } else {\n        next();\n      }\n    }\n  } else {\n    /* has no token*/\n    if (whiteList.indexOf(to.path) !== -1) {\n      // 在免登录白名单，直接进入\n      next();\n    } else {\n      next(\"/login?redirect=\".concat(to.path)); // 否则全部重定向到登录页\n\n      _nprogress.default.done();\n    }\n  }\n});\n\nvar loadMenus = function loadMenus(next, to) {\n  (0, _menu.buildMenus)().then(function (res) {\n    var asyncRouter = (0, _permission.filterAsyncRouter)(res);\n    asyncRouter.push({\n      path: '*',\n      redirect: '/404',\n      hidden: true\n    });\n\n    _store.default.dispatch('GenerateRoutes', asyncRouter).then(function () {\n      // 存储路由\n      _routers.default.addRoutes(asyncRouter); // 动态添加可访问路由表\n\n\n      next(_objectSpread(_objectSpread({}, to), {}, {\n        replace: true\n      }));\n    });\n  });\n};\n\nexports.loadMenus = loadMenus;\n\n_routers.default.afterEach(function () {\n  _nprogress.default.done(); // finish progress bar\n\n});",null]}